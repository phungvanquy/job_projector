# –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–°—Ö–µ–º–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ](#–°—Ö–µ–º–∞-–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ)
2. [–ò–Ω—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è](#–ò–Ω—Ç—Ä—É–∫—Ü–∏—è-–¥–ª—è-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
3. [–û–ø–∏—Å–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ü–û](#test-instruction)
4. [–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã –∏ —Ñ–æ—Ä–º–∞—Ç–∞ TCP/IP –ø–∞–∫–µ—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–∂–µ–∫—Ç–æ—Ä–æ–º](#–û–ø–∏—Å–∞–Ω–∏–µ-–ø—Ä–∏–Ω—Ü–∏–ø-—Ä–∞–±–æ—Ç—ã)

# <p id="–°—Ö–µ–º–∞-–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ">1. –°—Ö–µ–º–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ</p>

–≠—Ç–æ –ø–∞–≤–µ–ª —Å–¥–µ–ª–∞–µ—Ç </br>
!!! –í–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ: —á—Ç–æ pin A1(Arduino) –¥–ª—è –∏–∑–º–µ—Ä–µ–Ω–∏—è ADC value

# <p id="–ò–Ω—Ç—Ä—É–∫—Ü–∏—è-–¥–ª—è-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è"></p>2. –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

Run into Virtual Environment

```bash
python3 -m venv venv &&
source ./venv/bin/activate
```

Install all dependencies

```bash
pip install -r requirements.txt
```

Run test file

```bash
python3 main.py
```

Result must be like this:

```
Angle to set:5
Angle:  10
Angle:  10
Angle:  9
Angle:  8
Angle:  8
Angle:  8
Angle:  7
Angle:  7
Angle:  7
Angle:  6
Angle:  5
Angle to set:
```


# <p id="structure-description"></p> 3. –û–ø–∏—Å–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ü–û

```
üì¶backend
 ‚î£ üìÇmodel                  (Build Machine learning Model to convert ADC_value->angle or vice versa)
 ‚îÉ ‚î£ üìúdata.csv             (Dataset)
 ‚îÉ ‚îó üìúmodelEncoderADC.py   (Genereated ML model)
 ‚î£ üìúREADME.md              (Instruction file)
 ‚îÉ üìúmain.py                (Testing source file)
 ‚îó üìúrequirements.txt       (Dependencies file)
```

# <p id="–û–ø–∏—Å–∞–Ω–∏–µ-–ø—Ä–∏–Ω—Ü–∏–ø-—Ä–∞–±–æ—Ç—ã"></p>4. –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø–∞ —Ä–∞–±–æ—Ç—ã –∏ Modbus TCP/IP –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–∂–µ–∫—Ç–æ—Ä–æ–º

## 4.1. –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã:

<p style="text-align:justify" >1. –ò–∑ –ü–ö (master) Modbus Request –∑–∞–ø–∏—Å—å –≤ holding register (1001) –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω–∞ Arduino (slave). –í —ç—Ç–æ–º Request –≤–∫–ª—é—á–∞—é—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏–µ Angle_value –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–∂–µ–∫—Ç–æ—Ä–æ–º. Arduino –ø–æ–ª—É—á–∞–µ—Ç —ç—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏–π –∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç –º–æ—Ç–æ—Ä–æ–º —Ç–∞–∫ —á—Ç–æ–±—ã –ø—Ä–æ–∂–µ–∫—Ç–æ—Ä –ø–æ–≤–æ—Ä–∞—á–∏–≤–∞–ª –∫ –∂–µ–ª–∞–µ–º–æ–º—É —É–≥–ª—É. –û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —Å —ç—Ç–∏–º master –º–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å –∑–Ω–∞—á–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ —É–≥–ª–∞ –ø–æ–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏—è –ø—Ä–æ–∂–µ–∫—Ç–æ—Ä–∞ —Å –º–æ–º–æ—â—å—é modbus Request –Ω–∞ —á–∏—Ç–∞—Ç—å holding —Ä–µ–≥–∏—Å—Ç–æ—Ä (1002) </p>
<p style="text-align:justify" >2. –ö–∞–∫ –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ ADC –∏–∑ —É–≥–ª–∞? <br> - –û–Ω–æ –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å —Å –ø–æ–º–æ—â—å—é Machine learning model. –≠—Ç–æ model –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è Convert "angle" to "ADC_value".</p>

```python
from model.modelEncoderADC import angleToADC, ADCtoAngle
angle = 350
print("Converted ADC value:", angleToADC)
```
<p style="text-align:justify" > - –ï—Å–ª–∏ converting process –ø–æ–ª–æ–∂–∏–º –≤ Arduino to –º—ã –º–æ–∂–µ–º –ø–æ–ª—É—á–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —É ML model:</p>

```python
from model.modelEncoderADC import reg_angleToADC_model
print("Coef of model", reg_angleToADC_model.coef_)
print("Bias (or Intercept) of model", reg_angleToADC_model.intercept_)
``` 

<p style="text-align:justify" >3. –ü–æ—á–µ–º—É –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Machine Learning (ML) Model? <br> - –¢–∞–∫ –∫–∞–∫ –≤–æ –≤—Ä–µ–º—è —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞ –º—ã –∑–∞–º–µ—Ç–∏–ª–∏ —á—Ç–æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –º–µ–∂–¥—É —É–≥–ª–∞ –∏ –∑–Ω–∞—á–µ–Ω–∏–µ–º —ç–Ω–∫–æ–¥–µ—Ä–∞ (ADC_value) –ù–ï –õ–ò–ù–ï–ô–ù–û –∏–∑ –∑–∞ –ø–æ–≥—Ä–µ—à–Ω–æ—Å—Ç–∏ –∏ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∫–æ–º–ø–ª–µ–∫—Å–∞. –ü–æ—ç—Ç–æ–º—É  ML model (Polynomial regression) –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ä–µ—à–µ–Ω–∏—è —ç—Ç–æ–π –ø—Ä–æ–±–ª–µ–º—ã.  <br> - –°—É—Ç—å –º–µ—Ç–æ–¥–∞ –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è –≤ —Ç–æ–º —á—Ç–æ –º—ã –∏–∑–º–µ—Ä—è–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ —ç–Ω–∫–æ–¥–µ—Ä–∞ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å —Ä–∞–∑–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ —É–≥–ª–∞ –ø–æ–≤–æ—Ä–æ—Ç–∞ (–§–∞–π–ª /model/data.csv). –ò–∑ —ç—Ç–∏—Ö –¥–∞–Ω–Ω—ã—Ö –º—ã –º–æ–∂–µ–º –ø–æ—Å—Ç—Ä–æ–∏—Ç—å model (—Ñ—É–Ω–∫—Ü–∏—é –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É–≥–ª–∞ –∏ ADC_value). –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ —ç—Ç–æ–≥–æ –º–µ—Ç–æ–¥–∞ –≤ —Ç–æ–º —á—Ç–æ —Ç–µ–º –±–æ–ª—å—à–µ –¥–∞–Ω–Ω—ã–µ –º—ã –∏–∑–º–µ—Ä—è–µ–º, —á–µ–º —Ç–æ—á–Ω–µ–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–ª—É—á–∏–º</p>


## 4.2. –£–ø—Ä–∞–≤–ª—è—Ç—å –ø—Ä–æ–∂–µ–∫—Ç–æ—Ä–æ–º —Å Modbus TCP/IP:

<p style="text-align:justify">–¢–∞–∫ –∫–∞–∫ –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–æ—Ç–æ–∫–æ–ª Modbus TCP/IP socket protocol –ø–æ—ç—Ç–æ–º—É –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å Arduino socket: <br>
- ip: 192.168.1.222 <br>
- port: 502 <br>
–î–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–∂–µ–∫—Ç–æ—Ä–æ–º –Ω–∞–º –Ω—É–∂–Ω–æ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –∞–¥—Ä–µ—Å—ã —Ä–µ–≥–∏—Å—Ç–æ—Ä–æ–≤:
<table style="text-align:left">
  <tr>
    <th>Value</th>
    <th>Address</th>
    <th>Type Of Register</th>
    <th>MIN ---> MAX</th>
    <th>Description</th>

  </tr>
  <tr>
    <td>ADC_Value</td>
    <td>1000</td>
    <td>Holding Register</td>
    <td>-</td>
    <td>–¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ ADC value, –∫–æ—Ç–æ—Ä–æ–µ –º—ã —Ö–æ—Ç–∏–º —á–∏—Ç–∞—Ç—å</td>
  </tr>
    <tr>
    <td>Angle_Value_To_Set</td>
    <td>1001</td>
    <td>Holding Register</td>
    <td>(-18 ) 342 ---> 24 </td>
    <td>–ñ–µ–ª–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —É–≥–ª–∞, —Å –∫–æ—Ç–æ—Ä—ã–º –º—ã —Ö–æ—Ç–∏–º —É–ø—Ä–∞–≤–ª—è—Ç—å –ø—Ä–æ–∂–µ–∫—Ç–æ—Ä–æ–º</td>
  </tr>
    </tr>
    <tr>
    <td>Angle_Value</td>
    <td>1002</td>
    <td>Holding Register</td>
    <td>-</td>
    <td>–¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ ADC value, –∫–æ—Ç–æ—Ä–æ–µ –º—ã —Ö–æ—Ç–∏–º —á–∏—Ç–∞—Ç—å <br> (Its converted from ADC_Value with a trained model)</td>
  </tr>
</table>

<b>–í–Ω–∏–º–∞–Ω–∏–µ:</b> –ï—Å–ª–∏ –º—ã —Ö–æ—Ç–∏–º —á—Ç–æ–±—ã —Ç–æ—á–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã —É –ø—Ä–æ–∂–µ–∫—Ç–æ—Ä–∞ –±–æ–ª—å—à–µ –±—ã–ª–∞, —Ç–æ–≥–¥–∞ –Ω–∞–º –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ADC_value (–∞–¥—Ä–µ—Å 1000). –ú—ã –∏–∑–º–µ—Ä—è–µ–º —É–≥–ª—ã –∏ —Å–æ–ø–æ—Å—Ç–∞–≤–∏—Ç—å —ç—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è —Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ ADC_value. –ü–æ—Ç–æ–º –º—ã Train model –∑–∞–Ω–æ–≤–∞ 

–ü—Ä–∏–º–µ—Ä –≤ python
```python
# –≠—Ç–æ –ø—Ä–æ–≥—Ä–∞–º–º–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–∞–±–æ—Ç—ã –ø—Ä–æ–∂–µ—Ç–æ—Ä–∞
# 1. –°–Ω–∞—á–∞–ª–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω—É–∂–Ω–æ –∑–∞–¥–∞—Ç—å —É–≥–æ–ª –¥–ª—è —É–ø—Ä–∞–≤–ª—è—Ç—å. 
# 2. –ü–æ—Ç–æ–º –æ–Ω–∞ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ —á–∏—Ç–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è —É–≥–ª–∞ –ø—Ä–æ–∂–µ–∫—Ç–æ—Ä–∞
import time
from pyModbusTCP.client import ModbusClient
c = ModbusClient(host="192.168.1.222", port=502, unit_id=1, auto_open=True)

angleToSet = int(input("Angle to set:"))

# –ó–∞–¥–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è —É–≥–ª–∞ (–∞–¥—Ä–µ—Å 1001) —á—Ç–æ–±—ã —É–ø—Ä–∞–≤–ª—è—Ç—å
c.write_single_register(1001,angleToSet)
while(True):
    if(regs != angleToSet):
        # –ß–∏—Ç–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ —É–≥–ª–∞ –≤ —Ä–µ–≥–∏—Å—Ç–æ—Ä–µ (–∞–¥—Ä–µ—Å 1002)
        regs = c.read_holding_registers(1002,1)[0]
        print("Angle: ",regs)
    else:
        angleToSet = int(input("Angle to set:"))
        if angleToSet == 360:
          angleToSet = 0
        c.write_single_register(1001,angleToSet)
    time.sleep(0.05)
```

